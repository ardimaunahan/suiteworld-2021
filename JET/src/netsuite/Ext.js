Ext.ns("Ext.ux.form.HtmlEditor");if(!Ext.isObject){Ext.isObject=function(a){return a&&typeof a=="object";};}Ext.Toolbar.prototype.enableOverflow=true;Ext.override(Ext.form.HtmlEditor,{lastEditMadeInSourceMode:false,lastHtmlDisplayValue:null,getSelection:function(){var b=this.getWin();var a=this.getDoc();if(b.getSelection){return b.getSelection();}else{if(a.getSelection){return a.getSelection();}else{if(a.selection){return a.selection;}}}return null;},getSelectionRange:function(){if(!this.activated){this.iframe.focus();this.iframe.contentDocument.body.focus();this.textareaOnfocus();}this.win.focus();var a=this.getSelection();if(a.rangeCount==0){return this.getDefaultRange();}else{return a.getRangeAt(0);}},setSelectionRange:function(a){var b=this.getSelection();b.removeAllRanges();b.addRange(a);},getDefaultRange:function(){var a=this.getDoc();var b=a.createRange();b.setStart(a.body.firstChild,0);b.setEnd(a.body.firstChild,0);return b;},deleteSelectedText:function(a){a=(a||this.getSelectionRange());if(a!=null){a.deleteContents();}},getSelectedText:function(){var b=this.getSelectionRange();if(b==null){return null;}var d=jQuery(b.cloneContents());var a=d.html();var c=d.text();return{range:b,textContent:c,hasHTML:(a!=null),html:a||c};},pasteHtmlToRange:function(a,b){var f=this.getDoc();var c=f.createElement("div");c.innerHTML=b;var g=f.createDocumentFragment(),e,d;while((e=c.firstChild)){d=g.appendChild(e);}a.insertNode(g);},insertValue:function(p,r){if(isValEmpty(p)){return;}if(this.disabled){return;}if(!r){this.setFocus();setTimeout(new Function("getHtmlEditor('"+this.name+"').insertValue('"+p+"',true)"),200);return;}var m=this.handleEscaping(p,true);var c,k;var o=this.sourceEditMode?document:this.iframe.contentWindow.document;if((this.sourceEditMode&&this.el.dom.value==NLHTMLEDITOR_SOURCECODE_HELPER_TEXT)||(!this.sourceEditMode&&this.getValue()!=null&&this.getDisplayValue().indexOf(NLHTMLEDITOR_FORMATTED_HELPER_TEXT)!=-1)){this.setDisplayValue(m);}else{if(this.sourceEditMode){var f=this.el.dom;if(document.selection){f.focus();c=o.selection;k=c.createRange();k.text=m;k.collapse(false);k.select();}else{var d=f.textLength;var b=f.selectionStart;var g=f.selectionEnd;if(g==1||g==2){g=d;}this.setDisplayValue(f.value.substring(0,b)+m+f.value.substr(g,d));}}else{if(window.getSelection){this.getEditorBody().focus();c=(Ext.isChrome||Ext.isGecko)?this.getWin().getSelection():o.getSelection();try{k=c.getRangeAt(0);var j=o.createTextNode(this.sourceEditMode?m:p);if(k.startContainer.tagName=="DIV"&&k.startContainer.firstChild.tagName=="TEXTAREA"){var h=k.startContainer.firstChild;var n=h.selectionEnd+m.length;h.value=h.value.substring(0,h.selectionEnd)+m+h.value.substring(h.selectionEnd);h.selectionStart=h.selectionEnd=n;}else{if(k.collapsed){k.insertNode(j);}else{var q=o.createDocumentFragment();var a=k.extractContents();q.appendChild(a);q.appendChild(j);k.insertNode(q);}k.selectNodeContents(j);k.collapse(false);k.commonAncestorContainer.normalize();}}catch(l){this.setDisplayValue(m);}}else{if(o.selection){this.getEditorBody().focus();c=o.selection;k=c.createRange();k.collapse(false);k.pasteHTML(m);k.select();}}}}this.setValue(this.getDisplayValue());},focus:function(){if(this.disabled){return;}if(this.win&&!this.sourceEditMode){this.win.focus();}else{this.el.focus();}},setFocus:function(){this.focus();},iFrameOnfocus:function(){var a=this.getEditorBody();if(Ext.isIE){a.contentEditable=true;}if(a.innerHTML.indexOf(NLHTMLEDITOR_FORMATTED_HELPER_TEXT)>-1){a.innerHTML="<div></div>";a.focus();}},iFrameOnblur:function(){if(!this.sourceEditMode&&this.lastHtmlDisplayValue!==this.getDisplayValue()){this.syncValue();}return true;},textareaOnfocus:function(){this.textModeHasFocus=true;this.activated=true;if(this.el.dom.value==NLHTMLEDITOR_SOURCECODE_HELPER_TEXT){this.el.dom.style.fontFamily="";this.el.dom.style.color="";this.el.dom.value="";}},textareaOnblur:function(){this.textModeHasFocus=false;this.setValue(this.handleEscaping(this.el.dom.value));var b=this.handleEscaping(this.el.dom.value,true);var a=(!this.textModeHasFocus&&(typeof b=="undefined"||isValEmpty(b)));if(a){this.el.dom.value=NLHTMLEDITOR_SOURCECODE_HELPER_TEXT;this.el.dom.style.fontFamily="courier";this.el.dom.style.color="#666666";}this.pushValue(true);},setMandatory:function(b,a){this.mandatory=b;},getMandatory:function(){return(this.mandatory?this.mandatory:false);},hasAttribute:function(a){return(this.flags&a)!=0;},setFontSize:function(b){var a=b;if(a<=8){a=1;}else{if(a<=10){a=2;}else{if(a<=12){a=3;}else{if(a<=14){a=4;}else{if(a<=18){a=5;}else{if(a<=24){a=6;}else{a=7;}}}}}}a=a.constrain(1,7);this.relayCmd("FontSize",a);},getDisplayValue:function(b){var c=null;var a=(typeof b=="undefined"?false:b);if(this.sourceEditMode||a){c=this.el.dom.value;}else{c=this.getEditorBody().innerHTML;}c=this.handleEscaping(c,false);return c;},setDisplayValue:function(b){var n=this.handleEscaping(b,true);var m=(!this.textModeHasFocus&&(typeof n=="undefined"||isValEmpty(n)));if(this.sourceEditMode){if(m){this.el.dom.value=NLHTMLEDITOR_SOURCECODE_HELPER_TEXT;this.el.dom.style.fontFamily="courier";this.el.dom.style.color="#666666";}else{this.el.dom.value=n;this.el.dom.style.fontFamily="";this.el.dom.style.color="";}}else{if(m){n=NLHTMLEDITOR_FORMATTED_HELPER_TEXT_WITH_STYLE;}var k=this.getDoc();k.open("text/html","replace");var g=getCascadedStyle(document.body,"fontFamily","font-family");var a=g.toLowerCase();g=null;for(var c in fontNames){var h=fontNames[c].toLowerCase();if(h!=""&&a.indexOf(h)!=-1){g=h;break;}}var f=(g!=null?"font-family:'"+g+"';":"");k.write('<html style="'+f+"\"><body contenteditable='true' width=100%; height=100%; topmargin=1 leftmargin=1>");var d=/\s*<div>(.*)<\/div>\s*$/i;if(!d.test(n.split("\n").join("\r"))){n="<DIV>"+n+"</DIV>";}k.write(n);k.write("</body></html>");k.close();if(k){try{Ext.EventManager.removeAll(k);}catch(j){}}fn=this.onEditorEvent.createDelegate(this);Ext.EventManager.on(k,{mousedown:fn,dblclick:fn,click:fn,keyup:fn,buffer:100});var l=Ext.get(this.getEditorBody());l.on("paste",this.syncValue,this,{buffer:100});if(Ext.isGecko){Ext.EventManager.on(k,"keypress",this.applyCommand,this);}if(Ext.isIE||Ext.isWebKit||Ext.isOpera){Ext.EventManager.on(k,"keydown",this.fixKeys,this);}if(document.addEventListener){this.getDoc().onfocus=null;this.getDoc().addEventListener("focus",function(e){this.iFrameOnfocus();}.bind(this),true);this.getDoc().onblur=null;this.getDoc().addEventListener("blur",function(e){this.iFrameOnblur();}.bind(this),true);}else{this.getWin().onfocus=new Function("getHtmlEditor('"+this.name+"').iFrameOnfocus()");this.getWin().onblur=new Function("getHtmlEditor('"+this.name+"').iFrameOnblur();");}if(Ext.isGecko){k.body.removeAttribute("contenteditable");k.designMode="on";}this.lastHtmlDisplayValue=this.getDisplayValue();}},valueChanged:function(a){return(this.hddn.value!=a&&this.initialized);},setValue:function(b,d,g){var f=(typeof d=="undefined")?false:d;var e=(typeof g=="undefined")?false:g;if(this.hddn.value!=b&&this.initialized){NS.form.setChanged(true);this.lastEditMadeInSourceMode=(e?true:this.sourceEditMode);}var c=(this.value?this.value:"");this.value=b.replace(NLHTMLEDITOR_SOURCECODE_HELPER_TEXT,"").replace(NLHTMLEDITOR_FORMATTED_HELPER_TEXT_WITH_STYLE,"");this.hddn.value=this.value;if(this.onChangeFunc!=null){var a=this.hddn.onchange();if(a!=null&&!a){this.value=this.hddn.truncatedValue?this.hddn.value:c;this.hddn.value=this.value;this.setDisplayValue(this.value);}}if(f){this.setDisplayValue(this.value);}return this;},initEvents:function(){this.originalValue=this.getValue();},initValue:function(){if(this.value!==undefined){this.setValue(this.value);}else{if(!Ext.isEmpty(this.el.dom.value)&&this.el.dom.value!=this.emptyText){this.setValue(this.el.dom.value);}}this.originalValue=this.getValue();},getValue:function(){this[(this.sourceEditMode||this.lastEditMadeInSourceMode)?"pushValue":"syncValue"]();var a=(this.value===undefined?"":this.value);a=a.replace(/<br>$/im,"");return a;},execCmd:function(f,e,b){var d=f.toLowerCase();var b=(typeof b==="undefined")?false:b;var g=this.getDoc();if(Ext.isIE&&d==="inserthtml"){g.selection.createRange().pasteHTML(e===undefined?null:e);}else{if(Ext.isIE&&g.selection.type.toLowerCase()==="none"&&(d==="justifyleft"||d==="justifycenter"||d==="justifyright"||d==="insertorderedlist"||d==="insertunorderedlist"||d==="outdent"||d==="indent")){var c=this;var a=b;setTimeout(function(){g.execCommand(f,false,null);if(!a){c.syncValue();}},0);b=true;}else{g.execCommand(f,false,e===undefined?null:e);}}if(!b){this.syncValue();}},onEditorEvent:function(a){this.updateToolbar(a.type);},createFontOptions:function(){var d=[],b=ExtFontNames,c,g,f;for(var e=0,a=b.length;e<a;e++){c=b[e];f=c[0].toLowerCase();g=c[1];d.push('<option value="',f,'" style="font-family:',g,';"',(this.defaultFont&&this.defaultFont.toLowerCase()==f?' selected="true">':">"),g,"</option>");}return d.join("");},toggleSourceEdit:function(c){var e,b;if(c===undefined){c=!this.sourceEditMode;}if(c&&this.lastHtmlDisplayValue!==this.getDisplayValue()){this.syncValue();}var a=Ext.QuickTips&&Ext.QuickTips.isEnabled();var d=this.tb.getComponent("sourceedit");if(d.pressed!==c){d.toggle(c);}if(a){d.setTooltip(c?this.buttonTips.formattededit:this.buttonTips.sourceedit);}d.setIconClass(c?"x-edit-formattededit":"x-edit-sourceedit");if(this.sourceEditMode===c){return;}this.sourceEditMode=c===true;if(c){this.previousSize=this.getSize();e=Ext.get(this.iframe).getHeight();this.disableItems(true);this.setDisplayValue(this.value);this.iframe.className="x-hidden";this.el.removeClass("x-hidden");this.el.dom.removeAttribute("tabIndex");if(this.activated){this.el.focus();}this.el.dom.style.height=e+"px";}else{b=parseInt(this.el.dom.style.height,10);if(this.initialized){this.disableItems(this.readOnly);}if(this.lastEditMadeInSourceMode){this.setDisplayValue(this.value);}this.iframe.className="";this.el.addClass("x-hidden");this.el.dom.setAttribute("tabIndex",-1);if(this.activated){this.deferFocus();}this.setSize(this.previousSize);delete this.previousSize;this.iframe.style.height=b+"px";}this.fireEvent("editmodechange",this,this.sourceEditMode);},pushValue:function(c){var b=(typeof c=="undefined"?false:c);if(this.initialized){var a=this.getDisplayValue(b);if(!this.activated&&a.length<1){a=this.defaultValue;if(this.sourceEditMode||b){this.value=a;this.el.dom.value=a;}}if(this.fireEvent("beforepush",this,a)!==false){if(!this.sourceEditMode){this.setDisplayValue(a);if(Ext.isGecko){this.setDesignMode(false);this.setDesignMode(true);}}this.fireEvent("push",this,a);}}},cleanHtml:function(a){return this.cleanHtmlWithStrictMSO(a,false);},cleanHtmlWithStrictMSO:function(b,a){b=String(b);if(Ext.isGecko){b=this.cleanMSOHtml(b,a);}var c=false;if(!(Ext.isIE||Ext.isIE6||Ext.isIE7||Ext.isIE8||Ext.isWebKit||Ext.isSafari||Ext.isSafari2||Ext.isSafari3||Ext.isSafari4)){c=((b.match(/>[\n\r]?·[\n\r]?\</gm)!=null)||(b.match(/>[\n\r]?Â·[\n\r]?\</gm)!=null)||(b.match(/>[\n\r]?§[\n\r]?\</gm)!=null)||(b.match(/>[\n\r]?v[\n\r]?\</gm)!=null)||(b.match(/>[\n\r]?Ø[\n\r]?\</gm)!=null)||(b.match(/>[\n\r]?ü[\n\r]?\</gm)!=null));b=b.replace(/(>[\n\r]?)·([\n\r]?\<)/gm,"$1&bull;$2").replace(/(>[\n\r]?)Â·([\n\r]?\<)/gm,"$1&bull;$2").replace(/(>[\n\r]?)§([\n\r]?\<)/gm,"$1&#9632;$2").replace(/(>[\n\r]?)v([\n\r]?\<)/gm,"$1&#2947;$2").replace(/(>[\n\r]?)Ø([\n\r]?\<)/gm,"$1&#9658;$2").replace(/(>[\n\r]?)ü([\n\r]?\<)/gm,"$1&#x2713;$2");}if(Ext.isWebKit){b=b.replace(/\sclass="(?:Apple-style-span|khtml-block-placeholder)"/gi,"");}if(b.charCodeAt(0)==this.defaultValue.replace(/\D/g,"")){b=b.substring(1);}return{html:b,pasteBulletsFromWord:c};},setDisplayBeforeSync:function(c,b){if(b==true){this.suspendEvents();var a=this.getDoc();a.body.innerHTML=c;this.resumeEvents();return c;}else{return c;}},syncValue:function(d){if(this.initialized&&(!this.sourceEditMode||((typeof d!="undefined")&&d===true))){var e=this.getEditorBody();var c=this.getDisplayValue();if(Ext.isWebKit){var b=e.getAttribute("style");if(b!=null){var a=b.match(/text-align:(.*?);/i);if(a&&a[1]){c='<div style="'+a[0]+'">'+c+"</div>";}}}var f=this.cleanHtml(c);c=this.setDisplayBeforeSync(f.html,f.pasteBulletsFromWord);if(this.fireEvent("beforesync",this,c)!==false){this.setValue(c,false,false);this.fireEvent("sync",this,c);}}},onDisable:function(){var a=this.wrap.mask();Ext.form.HtmlEditor.superclass.onDisable.call(this);if(Ext.isIE){var b=Ext.DomQuery.selectNode("div.ext-el-mask",this.wrap.dom);b.style.height="10000px";}},onEnable:function(){this.wrap.unmask();Ext.form.HtmlEditor.superclass.onEnable.call(this);this.toggleSourceEdit(this.sourceEditMode);},cleanMSOHtml:function(b,e){var d=[/<!--(.*)-->/g,/<!--[^!]*!(.*)-->/g,/<!--(.*)>/g,/<!(.*)-->/g,/<xml[^>]*>/g,/<\/xml[^>]*>/g,/<\/?(meta|object)[^>]*>/g,/mso\-[^;];/g,/<\/?o:p[^>]*>/g,/<\/?v:[^>]*>/g,/<\/?o:[^>]*>/g,/<\/?m:[^>]*>/g,/<\/?st1:[^>]*>/g,/lang=\"[^\"]*\"/g,/lang=\'[^\"]*\'/g,/clear=\"all\"/g,/<w:[^>]*>(.*)<\/w:[^>]*>/g,/<\/?w:[^>]*>/g,/<![\[-].*?-*>/g,/\r/g,/<wbr[^>]*>/g];var a=[/<xml[^>]*>/g,/<\/xml[^>]*>/g,/<\/?(meta|object)[^>]*>/g,/mso\-[^;];/g,/<\/?o:p[^>]*>/g,/<\/?v:[^>]*>/g,/<\/?o:[^>]*>/g,/<\/?m:[^>]*>/g,/<\/?st1:[^>]*>/g,/lang=\"[^\"]*\"/g,/lang=\'[^\"]*\'/g,/clear=\"all\"/g,/<w:[^>]*>(.*)<\/w:[^>]*>/g,/<\/?w:[^>]*>/g,/<wbr[^>]*>/g];var c=(e?d:a);Ext.each(c,function(f){b=b.replace(f,"");});return b;},stripExtraDivs:function(d){var e=/<div/i;var c=/<\/div>/i;var m=/^>/;var a=/^>.*<BR(>|[^>]*>)\s*$/i;var b=/<BR(>|[^>]*>)\s*$/i;var l=(" "+d+" ").split(e);var o=new Array();o.push(l[0]);for(var g=1;g<l.length;g++){var p=l[g].split(c);o.push(p[0]);for(var f=1;f<p.length;f++){var h=o.pop();if(a.test(h)){h=h.substring(1);}else{if(m.test(h)){h=h.substring(1)+"<BR>";}else{if(!m.test(h)){h="<div"+h+"</div>";}}}o.push(o.pop()+h+p[f]);}}var n=o.pop();n=n.substring(0,n.length-1);while(b.test(n)){n=n.replace(b,"");}o.push(n);d=o.join("<div");d=d.substring(1);return d;},handleSpecialChars:function(g,c){g=g.replace(/%3CNL([^&\]]{2,})(%3E)/g,"<NL$1>");var f=g.match(/(<a)[\s\S]*?(>)/gi);var a;if(!isValEmpty(f)){for(var b=0;b<f.length;b++){a=f[b];f[b]=f[b].replace(/&amp;/g,"&");f[b]=f[b].replace(/&copy/g,"&amp;copy").replace(/&lang/g,"&amp;lang").replace(/&section/g,"&amp;section");g=g.replace(a,f[b]);}}var e=g.match(/(<a)[\s\S]*?(%C2%A9)[\s\S]*?(>)/gi);var d;if(!isValEmpty(e)){for(var b=0;b<e.length;b++){d=e[b];e[b]=e[b].replace(/%C2%A9/g,"&amp;copy");g=g.replace(d,e[b]);}}return g;},handleEscaping:function(b,a){if(!isValEmpty(b)&&!this.sourceEditMode){b=this.stripExtraDivs(b);b=b.replace(/<STRONG>/gi,"<B>").replace(/<\/STRONG>/gi,"</B>").replace(/<EM>/gi,"<I>").replace(/<\/EM>/gi,"</I>");b=a?b.replace(/<NL([^>]{2,})>/g,"&lt;NL$1&gt;"):b.replace(/&lt;NL([^&\]]{2,})(&gt;|>)/g,"<NL$1>");b=a?b.replace(/<(SCRIPT)\b/gi,"<!--NLHIDE:$1").replace(/(<\/SCRIPT\s*)>/gi,"$1:NLHIDE-->"):b.replace(/<\!--NLHIDE:/g,"<").replace(/:NLHIDE-->/g,">");}b=this.handleSpecialChars(b,a);return b;},createToolbar:function(e){var g=[];var j=Ext.QuickTips&&Ext.QuickTips.isEnabled();function b(m,k,l){return{itemId:m,cls:"x-btn-icon",iconCls:"x-edit-"+m,enableToggle:k!==false,scope:e,handler:l||e.relayBtnCmd,clickEvent:"mousedown",tooltip:j?e.buttonTips[m]||undefined:undefined,overflowText:e.buttonTips[m].title||undefined,tabIndex:-1};}if(this.enableSourceEdit){g.push(b("sourceedit",true,function(l,k){this.toggleSourceEdit(!this.sourceEditMode,false);}));}if(this.enableFont&&!Ext.isSafari2){var h=function(){var k=[];Ext.each(ExtFontNames,function(l){k.push([l[0].toLowerCase(),l[1]]);});return k;}();var f="fontfamily"+Ext.id();var d=new Ext.Toolbar.Item({autoEl:{tag:"select",cls:"x-font-select",id:f,html:this.createFontOptions()}});g.push(d,"-");}if(this.enableFormat){g.push(b("bold"),b("italic"),b("underline"));}if(this.enableFontSize){g.push("-",b("increasefontsize",false,this.adjustFont),b("decreasefontsize",false,this.adjustFont));}if(this.enableColors){g.push("-",{itemId:"forecolor",cls:"x-btn-icon",iconCls:"x-edit-forecolor",clickEvent:"mousedown",tooltip:j?e.buttonTips.forecolor||undefined:undefined,overflowText:j?e.buttonTips.forecolor.title||undefined:undefined,tabIndex:-1,menu:new Ext.menu.ColorMenu({allowReselect:true,focus:Ext.emptyFn,value:"000000",plain:true,listeners:{scope:this,select:function(l,k){this.execCmd("forecolor",Ext.isWebKit||Ext.isIE?"#"+k:k);this.deferFocus();}},clickEvent:"mousedown"})},{itemId:"backcolor",cls:"x-btn-icon",iconCls:"x-edit-backcolor",clickEvent:"mousedown",tooltip:j?e.buttonTips.backcolor||undefined:undefined,overflowText:j?e.buttonTips.backcolor.title||undefined:undefined,tabIndex:-1,menu:new Ext.menu.ColorMenu({focus:Ext.emptyFn,value:"FFFFFF",plain:true,allowReselect:true,listeners:{scope:this,select:function(l,k){if(Ext.isGecko){this.execCmd("useCSS",false);this.execCmd("hilitecolor",k);this.execCmd("useCSS",true);this.deferFocus();}else{this.execCmd(Ext.isOpera?"hilitecolor":"backcolor",Ext.isWebKit||Ext.isIE?"#"+k:k);this.deferFocus();}}},clickEvent:"mousedown"})});}if(this.enableAlignments){g.push("-",b("justifyleft"),b("justifycenter"),b("justifyright"));}if(!Ext.isSafari2){if(this.enableLinks){g.push("-",b("createlink",false,this.createLink));}if(this.enableLists){g.push("-",b("insertorderedlist"),b("insertunorderedlist"));}}var c=new Ext.Toolbar({renderTo:this.wrap.dom.firstChild,items:g});if(d){this.fontSelect=d.el;if(j&&e.buttonTips.font){Ext.QuickTips.register({target:this.fontSelect,title:e.buttonTips.font.title,text:e.buttonTips.font.text,cls:e.buttonTips.font.cls});}var a=(this.defaultFont?this.defaultFont:getCascadedStyle(document.body,"fontFamily","font-family")).toLowerCase();a=a.split(",")[0];if((a.indexOf("'")==0)||(a.indexOf('"')==0)){a=a.slice(1,-1);}if(a!=this.fontSelect.dom.value){this.fontSelect.dom.value=a;}this.mon(this.fontSelect,"change",function(){var k=this.fontSelect.dom.value;this.relayCmd("fontname",k);if(this.activated){this.deferFocus();}},this);}this.mon(c.el,"click",function(k){k.preventDefault();});this.tb=c;this.tb.doLayout();},updateToolbar:function(c){if(this.readOnly){return;}if(!this.activated){this.onFirstFocus();return;}c=(typeof c==="undefined")?"":c;var d=this.tb.items.map,e=this.getDoc();if(this.enableFont&&!Ext.isSafari2){var a=(e.queryCommandValue("FontName")||(this.defaultFont?this.defaultFont:"tahoma")).toLowerCase();a=a.split(",")[0];if((a.indexOf("'")==0)||(a.indexOf('"')==0)){a=a.slice(1,-1);}if(a!=this.fontSelect.dom.value){this.fontSelect.dom.value=a;}}try{if(this.enableFormat){d.bold.toggle(e.queryCommandState("bold"));d.italic.toggle(e.queryCommandState("italic"));d.underline.toggle(e.queryCommandState("underline"));}if(this.enableAlignments){d.justifyleft.toggle(e.queryCommandState("justifyleft"));d.justifycenter.toggle(e.queryCommandState("justifycenter"));d.justifyright.toggle(e.queryCommandState("justifyright"));}if(!Ext.isSafari2&&this.enableLists){d.insertorderedlist.toggle(e.queryCommandState("insertorderedlist"));d.insertunorderedlist.toggle(e.queryCommandState("insertunorderedlist"));}}catch(b){console.log(b);this.onFirstFocus();}Ext.menu.MenuMgr.hideAll();if(c==="keyup"){this.syncValue();}},adjustFont:function(b){var d=b.getItemId()=="increasefontsize"?1:-1,c=this.getDoc(),a=parseInt(c.queryCommandValue("FontSize")||2,10);if((Ext.isSafari&&!Ext.isSafari2)||Ext.isChrome||Ext.isAir){if(a<=10){if((Ext.isChrome||Ext.isSafari)&&(a<=7)){a=a+d;}else{a=1+d;}}else{if(a<=13){a=2+d;}else{if(a<=16){a=3+d;}else{if(a<=18){a=4+d;}else{if(a<=24){a=5+d;}else{a=6+d;}}}}}a=a.constrain(1,6);}else{if(Ext.isSafari){d*=2;}a=Math.max(1,a+d)+(Ext.isSafari?"px":0);}this.execCmd("FontSize",a);},getDocMarkup:function(){var a=Ext.fly(this.iframe).getHeight()-this.iframePad*2;return String.format('<html><head><style type="text/css">body{border: 0; margin: 0; padding: {0}px; height: (1)px; cursor: text}</style></head><body></body></html>',this.iframePad,a);},getField:function(){return(this.sourceEditMode)?this.el.dom:this.getEditorBody();},createIFrame:function(){var a=document.createElement("iframe");a.title=(typeof NS!=="undefined"&&NS.Translations&&NS.Translations.dictionary["NLPagemessageContext.CONTENT_EDITOR"])||"Content editor";a.name=Ext.id();a.frameBorder="0";a.style.overflow="auto";a.src=Ext.SSL_SECURE_URL;a.style.height=(this.renderHeight-33)+"px";a.style.width=(this.renderWidth-2)+"px";this.wrap.dom.appendChild(a);this.iframe=a;this.monitorTask=Ext.TaskMgr.start({run:this.checkDesignMode,scope:this,interval:100});},onRender:function(b,a){this.defaultAutoCreate={tag:"textarea",style:("resize: none;width:"+(this.renderWidth-2)+"px;height:"+(this.renderHeight-33)+"px;"),autocomplete:"off"};Ext.form.HtmlEditor.superclass.onRender.call(this,b,a);this.el.dom.style.border="0 none";this.el.dom.setAttribute("tabIndex",-1);this.el.addClass("x-hidden");if(Ext.isIE){this.el.applyStyles("margin-top:-1px;margin-bottom:-1px;");}this.wrap=this.el.wrap({cls:"x-html-editor-wrap",width:(this.renderWidth-2)+"px",cn:{cls:"x-html-editor-tb",style:"width: "+(this.renderWidth-2)+"px;"}});this.createToolbar(this);this.disableItems(true);this.tb.doLayout();this.createIFrame();this.setSize(this.renderWidth,this.renderHeight);this.resizeEl=this.positionEl=this.wrap;},disableItems:function(a){if(this.fontSelect){this.fontSelect.dom.disabled=a;}this.tb.items.each(function(b){if(b.getItemId()!="sourceedit"){b.setDisabled(a);}});},refreshEditMode:function(){var b,a;if(this.sourceEditMode){this.previousSize=this.getSize();b=Ext.get(this.iframe).getHeight();this.disableItems(true);this.syncValue();this.iframe.className="x-hidden";this.el.removeClass("x-hidden");this.el.dom.removeAttribute("tabIndex");this.el.dom.style.height=b+"px";}else{a=parseInt(this.el.dom.style.height,10);if(this.initialized){this.disableItems(this.readOnly);}if(this.lastEditMadeInSourceMode){this.pushValue();}this.iframe.className="";this.el.addClass("x-hidden");this.el.dom.setAttribute("tabIndex",-1);this.setSize(this.previousSize);delete this.previousSize;this.iframe.style.height=a+"px";}},onFirstFocus:function(){this.activated=true;this.disableItems(this.readOnly||this.sourceEditMode);if(Ext.isGecko){this.win.focus();var a=this.win.getSelection();if(!a.focusNode||a.focusNode.nodeType!=3){var b=a.getRangeAt(0);b.selectNodeContents(this.getEditorBody());b.collapse(true);this.deferFocus();}try{this.execCmd("useCSS",true,true);this.execCmd("styleWithCSS",false,true);}catch(c){}}this.fireEvent("activate",this);if(this.value==""){if(this.defaultFont){NS.jQuery("[selected=true]",this.fontSelect.dom).attr("selected","false");this.fontSelect.dom.value=this.defaultFont;this.relayCmd("fontname",this.defaultFont);}if(this.customFontSize){this.setFontSize(this.customFontSize);}}},setReadOnly:function(b){Ext.form.HtmlEditor.superclass.setReadOnly.call(this,b);if(this.initialized){if(Ext.isIE){this.getEditorBody().contentEditable=!b;}else{this.setDesignMode(!b);}var a=this.getEditorBody();if(a){a.style.cursor=this.readOnly?"default":"text";}this.disableItems(b||this.sourceEditMode);}},applyCommand:function(d){if(d.ctrlKey){var f=d.getCharCode(),b;if(f>0){f=String.fromCharCode(f);switch(f){case"b":b="bold";break;case"i":b="italic";break;case"u":b="underline";break;}if(b){this.win.focus();this.execCmd(b);this.deferFocus();d.preventDefault();}}}else{if(d.keyCode==d.ENTER){var a=this.win.getSelection().anchorNode;if(a.parentNode.tagName.toLowerCase()=="body"){this.execCmd("formatblock","<p>");}}}},insertFormatBlock:function(a){if(a.indexOf("<")==-1){a="<"+a+">";}if(Ext.isGecko){a=a.replace(/<(div|blockquote|code|dt|dd|dl|samp)>/gi,"$1");}this.relayCmd("FormatBlock",a);},fixKeys:function(){if(Ext.isIE){return function(f){var a=f.getKey(),d=this.getDoc(),b;if(a==f.TAB){f.stopEvent();b=d.selection.createRange();if(b){b.collapse(true);b.pasteHTML("&nbsp;&nbsp;&nbsp;&nbsp;");this.deferFocus();}}else{if(a==f.ENTER){b=d.selection.createRange();if(b){var c=b.parentElement();if(!c||c.tagName.toLowerCase()!="li"&&f.shiftKey){f.stopEvent();b.pasteHTML("<br />");b.collapse(false);b.select();}else{this.insertFormatBlock("p");}}}}};}else{if(Ext.isOpera){return function(b){var a=b.getKey();if(a==b.TAB){b.stopEvent();this.win.focus();this.execCmd("InsertHTML","&nbsp;&nbsp;&nbsp;&nbsp;");this.deferFocus();}};}else{if(Ext.isWebKit){return function(f){var d=this.getDoc();var a=f.getKey();if(a==f.TAB){f.stopEvent();this.execCmd("InsertText","\t");this.deferFocus();}else{if(a==f.ENTER){var b=d.getSelection();if(b){var c=b.anchorNode.parentNode.nodeName.toLowerCase();if(c=="ol"||c=="ul"){Ext.EventManager.on(d,"keyup",this.delDivs,this);}}}}};}}}}(),delDivs:function(){var d=this.getDoc();var b=d.getElementsByTagName("div");for(var a=0;a<b.length;a++){var e=b[a];if(e.childNodes.length===1&&e.firstChild.nodeName.toLowerCase()==="br"){e.parentNode.replaceChild(d.createElement("br"),e);}}this.iframe.focus();this.execCmd("selectall");var c=d.getElementsByTagName("html")[0].innerHTML;this.execCmd("InsertHtml",c);this.iframe.contentWindow.scrollTo(0,1000000);Ext.EventManager.un(d,"keyup",this.delDivs,this);},initEditor:function(){try{var c=this.getEditorBody(),a=this.el.getStyles("font-size","font-family","background-image","background-repeat","background-color","color"),f,b;a["background-attachment"]="fixed";c.bgProperties="fixed";Ext.DomHelper.applyStyles(c,a);f=this.getDoc();if(f){try{Ext.EventManager.removeAll(f);}catch(d){}}b=this.onEditorEvent.createDelegate(this);Ext.EventManager.on(f,{mousedown:b,dblclick:b,click:b,keyup:b,buffer:100});var g=Ext.get(this.getEditorBody());g.on("paste",this.syncValue,this,{buffer:100});if(Ext.isGecko){Ext.EventManager.on(f,"keypress",this.applyCommand,this);}if(Ext.isIE||Ext.isWebKit||Ext.isOpera){Ext.EventManager.on(f,"keydown",this.fixKeys,this);}if(document.addEventListener){this.getDoc().onfocus=null;this.getDoc().addEventListener("focus",function(e){this.iFrameOnfocus();}.bind(this),true);this.getDoc().onblur=null;this.getDoc().addEventListener("blur",function(e){this.iFrameOnblur();}.bind(this),true);}else{this.getWin().onfocus=new Function("getHtmlEditor('"+this.name+"').iFrameOnfocus()");this.getWin().onblur=new Function("getHtmlEditor('"+this.name+"').iFrameOnblur();");}this.el.dom.onkeypress=new Function("event","setEventCancelBubble(event); return true");f.editorInitialized=true;this.initialized=true;this.pushValue();this.setReadOnly(this.readOnly);this.fireEvent("initialize",this);}catch(d){}},initFrame:function(){Ext.TaskMgr.stop(this.monitorTask);var b=this.getDoc();this.win=this.getWin();b.open("text/html","replace");b.write(this.getDocMarkup());b.close();var a={run:function(){var c=this.getDoc();if(c.body||c.readyState=="complete"){Ext.TaskMgr.stop(a);if(Ext.isIE){this.getEditorBody().contentEditable=true;}else{this.setDesignMode(true);}this.initEditor.defer(10,this);}},interval:10,duration:10000,scope:this};Ext.TaskMgr.start(a);},buttonTips:{font:{title:"Font Select",text:"Select the font typeface.",cls:"x-html-editor-tip"},bold:{title:"Bold (Ctrl+B)",text:"Make the selected text bold.",cls:"x-html-editor-tip"},italic:{title:"Italic (Ctrl+I)",text:"Make the selected text italic.",cls:"x-html-editor-tip"},underline:{title:"Underline (Ctrl+U)",text:"Underline the selected text.",cls:"x-html-editor-tip"},increasefontsize:{title:"Increase Text Size",text:"Increase the font size.",cls:"x-html-editor-tip"},decreasefontsize:{title:"Decrease Text Size",text:"Decrease the font size.",cls:"x-html-editor-tip"},backcolor:{title:"Highlight Color",text:"Change the background color of the selected text.",cls:"x-html-editor-tip"},forecolor:{title:"Text Color",text:"Change the color of the selected text.",cls:"x-html-editor-tip"},justifyleft:{title:"Align Left",text:"Align text to the left.",cls:"x-html-editor-tip"},justifycenter:{title:"Center",text:"Center text in the editor.",cls:"x-html-editor-tip"},justifyright:{title:"Align Right",text:"Align text to the right.",cls:"x-html-editor-tip"},insertunorderedlist:{title:"Bulleted List",text:"Start a bulleted list.",cls:"x-html-editor-tip"},insertorderedlist:{title:"Numbered List",text:"Start a numbered list.",cls:"x-html-editor-tip"},createlink:{title:"Insert Link",text:"Make the selected text a hyperlink.",cls:"x-html-editor-tip"},formattededit:{title:"Source Edit Mode",text:"Click to switch to Formatted Text editing mode.",cls:"x-html-editor-tip"},sourceedit:{title:"Formatted Edit Mode",text:"Click to switch to Source editing mode.",cls:"x-html-editor-tip"},indent:{title:"Increase Indent",text:"Increase Indent",cls:"x-html-editor-tip"},outdent:{title:"Decrease Indent",text:"Decrease Indent",cls:"x-html-editor-tip"}}});Ext.ux.form.HtmlEditor.MidasCommand=Ext.extend(Ext.util.Observable,{init:function(a){this.cmp=a;this.btns=[];this.cmp.on("render",this.onRender,this);this.cmp.on("initialize",this.onInit,this,{delay:100,single:true});},onInit:function(){Ext.EventManager.on(this.cmp.getDoc(),{mousedown:this.onEditorEvent,dblclick:this.onEditorEvent,click:this.onEditorEvent,keyup:this.onEditorEvent,buffer:100,scope:this});},onRender:function(){var d,a=this.cmp.getToolbar(),c,b;Ext.each(this.midasBtns,function(e){if(Ext.isObject(e)){b=(e.iconCls)?e.iconCls:"x-edit-"+e.cmd;if(e.value){b=b+"-"+e.value.replace(/[<>\/]/g,"");}d={iconCls:b,handler:function(){this.cmp.relayCmd(e.cmd,e.value);},scope:this,tooltip:e.tooltip||{title:e.title},overflowText:e.overflowText||e.title};}else{d=new Ext.Toolbar.Separator();}c=a.addButton(d);if(e.enableOnSelection){c.disable();}this.btns.push(c);},this);},onEditorEvent:function(){var a=this.cmp.getDoc();Ext.each(this.btns,function(c,d){if(this.midasBtns[d].enableOnSelection||this.midasBtns[d].disableOnSelection){if(a.getSelection){if((this.midasBtns[d].enableOnSelection&&a.getSelection()!=="")||(this.midasBtns[d].disableOnSelection&&a.getSelection()==="")){c.enable();}else{c.disable();}}else{if(a.selection){if((this.midasBtns[d].enableOnSelection&&a.selection.createRange().text!=="")||(this.midasBtns[d].disableOnSelection&&a.selection.createRange().text==="")){c.enable();}else{c.disable();}}}}if(this.midasBtns[d].monitorCmdState){c.toggle(a.queryCommandState(this.midasBtns[d].cmd));}},this);}});Ext.ns("NetSuite");NetSuite.RTEManager=function(){var f=new Ext.util.MixedCollection();var b=new Ext.util.MixedCollection();var a=[];var e=false;var d=0;var c=false;return{initialize:function(){},saveSelection:function(){},restoreSelection:function(){},validateRTE:function(h,j,n,g){var o=this.getInstance(h);var p='<?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head><link rel="stylesheet" type="text/css" href="http://prettydiff.com/diffview.css" media="all"/></head><body><span class="clear"></span><div id="diffoutput">';var l=getHtmlEditor(h).getValue();var m=HTMLtoXML(l);var k=prettydiff({source:l,diff:m,mode:"diff",diffview:"inline"});new Ext.Window({title:(g!=undefined?g:o.getName()),id:o.getName()+"_window",name:o.getName()+"_window",stateful:false,autoScroll:scrollbars,width:""+Math.min(screen.availWidth,j+20)+"px",height:""+Math.min(screen.availHeight-40,n+20)+"px",left:""+(screen.availWidth-j)+"px",top:""+((screen.availHeight-40)-n)+"px",style:"background-color: #FFFFFF;",bodyStyle:"background-color: #FFFFFF;",resizable:true,modal:true,html:p+"</div>"+k[0]+"</body></html>"}).show();},registerRTE:function(g){f.add(g.widgetID,{obj:g.widgetComponentInstance,hiddenID:g.widgetHiddenElementID});},registerRTEs:function(h){for(var g=0;g<h.length;g++){this.registerRTE(h[g]);}},unregisteRTE:function(g){f.removeKey(g);},finalizeIfLastInitialized:function(j){var h=f.getCount();var g=this.findInstance(j);if(g!=null){g.finalized=true;if(++d===h){this.finalizeLoading();}}},finalizeLoading:function(){for(var g=0;g<a.length;g++){a[g]();}e=true;},addRTEFinalizeFunction:function(g){a.push(g);if(e){g();}},registerDeferredRTEInitialization:function(h,g){if(h.indexOf("html-editor-")!=0){h="html-editor-"+h;}b.add(h,{fn:g});},unregisterDeferredRTEInitialization:function(g){if(g.indexOf("html-editor-")!=0){g="html-editor-"+g;}b.removeKey(g);},getInstance:function(g){return this.findInstance(g);},findInstance:function(h){var g=null;if(f.containsKey(h)){g=f.get(h).obj;}return g;},getDeferredInitializationInstance:function(g){if(g.indexOf("html-editor-")!=0){g="html-editor-"+g;}return this.findDeferredInitializationInstance(g);},findDeferredInitializationInstance:function(h){var g=null;if(b.containsKey(h)){g=b.get(h).fn;}return g;},resyncSizeAll:function(g){g=g||false;f.eachKey(function(j,l){if(l&&l.obj){var h=l.obj.wrap.dom;if(typeof(jQuery)!="undefined"){h=jQuery(h).closest(".x-html-editor-wrap")[0];}else{while((h!=null)&&(h.className.indexOf(".x-html-editor-wrap")==-1)){h=h.parentNode;}}if(h==null){return;}var m=h.clientWidth;var k=((l.obj.lastWidth&&!g)?l.obj.lastWidth:Math.max(l.obj.renderWidth,m));if((!l.obj.lastWidth||g)&&(m>0)){l.obj.lastWidth=k;}l.obj.setSize(k,l.obj.renderHeight);l.obj.syncSize();l.obj.tb.doLayout();l.obj.refreshEditMode();}});},getMap:function(){return f;},rteMap:f};}();Ext.ux.form.HtmlEditor.Divider=Ext.extend(Ext.util.Observable,{init:function(a){this.cmp=a;this.cmp.on("render",this.onRender,this);},onRender:function(){this.cmp.getToolbar().addButton([new Ext.Toolbar.Separator()]);}});Ext.ux.form.HtmlEditor.FindAndReplace=Ext.extend(Ext.util.Observable,{langTitle:"Find/Replace",langFind:"Find",langReplace:"Replace",langReplaceWith:"Replace with",langClose:"Close",cmd:"findandreplace",init:function(a){this.cmp=a;this.cmp.on({render:this.onRender,editmodechange:this.editModeChange,scope:this});this.lastSelectionStart=-1;},editModeChange:function(b,a){if(this.btn&&a){this.btn.setDisabled(false);}},onRender:function(){this.btn=this.cmp.getToolbar().addButton({iconCls:"x-edit-findandreplace",sourceEditEnabled:true,handler:function(){if(!this.farWindow){this.farWindow=new Ext.Window({title:this.langTitle,closeAction:"hide",width:270,items:[{itemId:"findandreplace",xtype:"form",border:false,plain:true,bodyStyle:"padding: 10px;",labelWidth:80,labelAlign:"right",items:[{xtype:"textfield",allowBlank:false,fieldLabel:this.langFind,name:"find",width:145},{xtype:"textfield",allowBlank:true,fieldLabel:this.langReplaceWith,name:"replace",width:145}]}],buttons:[{text:this.langFind,handler:this.doFind,scope:this},{text:this.langReplace,handler:this.doReplace,scope:this},{text:this.langClose,handler:function(){this.farWindow.hide();},scope:this}]});}else{this.farWindow.getEl().frame();}this.farWindow.show();},scope:this,tooltip:{title:this.langTitle},overflowText:this.langTitle});},doFind:function(){var h=this.farWindow.getComponent("findandreplace").getForm();if(!h.isValid()){return"";}var g=h.findField("find").getValue();var c=h.findField("replace").getValue();if(this.cmp.sourceEditMode){var b=this.cmp.el.dom;var d=b.selectionStart===this.lastSelectionStart?b.selectionStart+1:b.selectionStart;var a=b.value.substring(d);var f=new RegExp(g);var e=a.search(f);if(e==-1){return;}this.lastSelectionStart=d+e;if(Ext.isGecko){b.setSelectionRange(this.lastSelectionStart,this.lastSelectionStart+g.length);this.cmp.scrollIntoView(d);this.cmp.focus(false,true);}}},doReplace:function(){var h=this.farWindow.getComponent("findandreplace").getForm();if(!h.isValid()){return"";}var g=h.findField("find").getValue();var d=h.findField("replace").getValue();if(this.cmp.sourceEditMode){var b=this.cmp.el.dom;var f=b.selectionStart;var e=b.selectionEnd;var a=b.value;if(Ext.isGecko){var c=b.scrollTop;b.value=a.substring(0,f)+d+a.substring(e);b.setSelectionRange(f,f+d.length);b.scrollTop=c;this.cmp.focus(false,true);}}}});Ext.ux.form.HtmlEditor.Font=Ext.extend(Ext.util.Observable,{init:function(a){this.cmp=a;this.cmp.on("render",this.onRender,this);},onRender:function(){var b=this.cmp;var c=function(){var d=[];Ext.each(b.fontFamilies,function(e){d.push([e.toLowerCase(),e]);});return d;}();var a=this.cmp.getToolbar().addItem({xtype:"combo",displayField:"display",valueField:"value",name:"fontfamily",forceSelection:true,mode:"local",triggerAction:"all",width:80,emptyText:"Font",tpl:'<tpl for="."><div class="x-combo-list-item" style="font-family:{value};">{display}</div></tpl>',store:{xtype:"arraystore",autoDestroy:true,fields:["value","display"],data:c},listeners:{select:function(d,e){this.relayCmd("fontname",e.get("value"));this.deferFocus();d.reset();},scope:b}});}});Ext.ux.form.HtmlEditor.FontSizeMenu=Ext.extend(Ext.util.Observable,{init:function(a){this.cmp=a;this.cmp.on("render",this.onRender,this);},onRender:function(){var b=this.cmp;var a=this.cmp.getToolbar().addItem({xtype:"combo",displayField:"display",valueField:"value",name:"fontsize",forceSelection:true,mode:"local",triggerAction:"all",width:65,emptyText:"Size",store:{xtype:"arraystore",autoDestroy:true,fields:["value","display"],data:[["1","10px"],["2","13px"],["3","16px"],["4","18px"],["5","24px"],["6","36px"]]},listeners:{select:function(c,d){this.relayCmd("fontsize","<"+d.get("value")+">");c.reset();},scope:b}});}});Ext.ux.form.HtmlEditor.HeadingButtons=Ext.extend(Ext.ux.form.HtmlEditor.MidasCommand,{midasBtns:["|",{enableOnSelection:true,cmd:"formatblock",value:"<h1>",tooltip:{title:"1st Heading"},overflowText:"1st Heading"},{enableOnSelection:true,cmd:"formatblock",value:"<h2>",tooltip:{title:"2nd Heading"},overflowText:"2nd Heading"}]});Ext.ux.form.HtmlEditor.HeadingMenu=Ext.extend(Ext.util.Observable,{init:function(a){this.cmp=a;this.cmp.on("render",this.onRender,this);},onRender:function(){var b=this.cmp;var a=this.cmp.getToolbar().addItem({xtype:"combo",displayField:"display",valueField:"value",name:"headingsize",forceSelection:true,mode:"local",triggerAction:"all",width:65,emptyText:"Heading",store:{xtype:"arraystore",autoDestroy:true,fields:["value","display"],data:[["H1","1st Heading"],["H2","2nd Heading"],["H3","3rd Heading"],["H4","4th Heading"],["H5","5th Heading"],["H6","6th Heading"]]},listeners:{select:function(c,d){this.relayCmd("formatblock","<"+d.get("value")+">");c.reset();},scope:b}});}});Ext.ux.form.HtmlEditor.HR=Ext.extend(Ext.util.Observable,{langTitle:"Horizontal Rule",langHelp:"Enter the width of the Rule in percentage<br/> followed by the % sign at the end, or to<br/> set a fixed width ommit the % symbol.",langInsert:"Insert",langCancel:"Cancel",langWidth:"Width",defaultHRWidth:"100%",cmd:"hr",init:function(a){this.cmp=a;this.cmp.on("render",this.onRender,this);},onRender:function(){var b=this.cmp;var a=this.cmp.getToolbar().addButton({iconCls:"x-edit-hr",handler:function(){if(!this.hrWindow){this.hrWindow=new Ext.Window({title:this.langTitle,width:240,closeAction:"hide",items:[{itemId:"insert-hr",xtype:"form",border:false,plain:true,bodyStyle:"padding: 10px;",labelWidth:60,labelAlign:"right",items:[{xtype:"label",html:this.langHelp+"<br/>&nbsp;"},{xtype:"textfield",maskRe:/[0-9]|%/,regex:/^[1-9][0-9%]{1,3}/,fieldLabel:this.langWidth,name:"hrwidth",width:60,value:this.defaultHRWidth,listeners:{specialkey:function(c,d){if((d.getKey()==d.ENTER||d.getKey()==d.RETURN)&&c.isValid()){this.doInsertHR();}},scope:this}}]}],buttons:[{text:this.langInsert,handler:function(){var c=this.hrWindow.getComponent("insert-hr").getForm();if(c.isValid()){this.doInsertHR();}else{c.findField("hrwidth").getEl().frame();}},scope:this},{text:this.langCancel,handler:function(){this.hrWindow.hide();},scope:this}],listeners:{render:(Ext.isGecko)?this.focusHRLong:this.focusHR,show:this.focusHR,move:this.focusHR,scope:this}});}else{this.hrWindow.getEl().frame();}this.hrWindow.show();},scope:this,tooltip:{title:this.langInsert+" "+this.langTitle},overflowText:this.langTitle});},focusHRLong:function(a){this.focus(a,600);},focusHR:function(a){this.focus(a,100);},focus:function(b,a){b.getComponent("insert-hr").getForm().findField("hrwidth").focus(true,a);},doInsertHR:function(){var b=this.hrWindow.getComponent("insert-hr").getForm();if(b.isValid()){var a=b.findField("hrwidth").getValue();if(a){this.insertHR(a);}else{this.insertHR(this.defaultHRWidth);}b.reset();this.hrWindow.hide();}},insertHR:function(a){this.cmp.insertAtCursor('<hr width="'+a+'">');}});Ext.ux.form.HtmlEditor.Image=Ext.extend(Ext.util.Observable,{langTitle:"Insert Image",urlSizeVars:["width","height"],basePath:"image.php",init:function(a){this.cmp=a;this.cmp.on("render",this.onRender,this);this.cmp.on("initialize",this.onInit,this,{delay:100,single:true});},onEditorMouseUp:function(a){Ext.get(a.getTarget()).select("img").each(function(d){var b=d.getAttribute("width"),c=d.getAttribute("height"),e=d.getAttribute("src")+" ";e=e.replace(new RegExp(this.urlSizeVars[0]+"=[0-9]{1,5}([&| ])"),this.urlSizeVars[0]+"="+b+"$1");e=e.replace(new RegExp(this.urlSizeVars[1]+"=[0-9]{1,5}([&| ])"),this.urlSizeVars[1]+"="+c+"$1");d.set({src:e.replace(/\s+$/,"")});},this);},onInit:function(){Ext.EventManager.on(this.cmp.getDoc(),{mouseup:this.onEditorMouseUp,buffer:100,scope:this});},onRender:function(){var a=this.cmp.getToolbar().addButton({iconCls:"x-edit-image",handler:this.selectImage,scope:this,tooltip:{title:this.langTitle},overflowText:this.langTitle});},selectImage:Ext.emptyFn,insertImage:function(a){this.cmp.insertAtCursor('<img src="'+this.basePath+"?"+this.urlSizeVars[0]+"="+a.Width+"&"+this.urlSizeVars[1]+"="+a.Height+"&id="+a.ID+'" title="'+a.Name+'" alt="'+a.Name+'">');}});Ext.ux.form.HtmlEditor.IndentOutdent=Ext.extend(Ext.ux.form.HtmlEditor.MidasCommand,{midasBtns:["|",{cmd:"outdent",tooltip:{title:"Decrease Indent"},overflowText:"Decrease Indent"},{cmd:"indent",tooltip:{title:"Increase Indent"},overflowText:"Increase Indent"}]});Ext.ux.form.HtmlEditor.Link=Ext.extend(Ext.util.Observable,{langTitle:"Insert Link",langInsert:"Insert",langCancel:"Cancel",langTarget:"Target",langURL:"URL",langText:"Text",linkTargetOptions:[["_self","Default"],["_blank","New Window"],["_parent","Parent Window"],["_top","Entire Window"]],init:function(a){a.enableLinks=false;this.cmp=a;this.cmp.on("render",this.onRender,this);},onRender:function(){var b=this.cmp;var a=this.cmp.getToolbar().addButton({iconCls:"x-edit-createlink",handler:function(){var c=this.cmp.getSelectedText();if(!c){return;}if(!this.linkWindow){this.linkWindow=new Ext.Window({title:this.langTitle,closeAction:"hide",width:300,height:200,items:[{xtype:"form",itemId:"insert-link",border:false,plain:true,bodyStyle:"padding: 10px;",labelWidth:40,labelAlign:"right",items:[{xtype:"textfield",fieldLabel:this.langText,name:"text",anchor:"100%",value:""},{xtype:"textfield",fieldLabel:this.langURL,vtype:"url",name:"url",anchor:"100%",value:"http://"},{xtype:"combo",fieldLabel:this.langTarget,name:"target",style:"border-right: 0px;",forceSelection:true,mode:"local",store:new Ext.data.ArrayStore({autoDestroy:true,fields:["spec","val"],data:this.linkTargetOptions}),triggerAction:"all",value:"_self",displayField:"val",valueField:"spec",anchor:"100%"}]}],buttons:[{text:this.langInsert,handler:function(){var m=this.linkWindow.getComponent("insert-link").getForm();if(m.isValid()){var l="",n=m.findField("text").getValue(),d=m.findField("url").getValue(),k=m.findField("target").getValue();this.cmp.deleteSelectedText(c.range);this.cmp.setSelectionRange(c.range);if(n.length&&n[n.length-1]==" "){n=n.substr(0,n.length-1);l=" ";}if(c.hasHTML){n=c.html;}var h='<a href="'+d+'" target="'+k+'">'+n+"</a>"+l;if(Ext.isGecko){var e=new UUID();h='<a id="'+e.id+'" href="'+d+'">'+n+"</a>"+l;if(this.cmp.activated){this.cmp.win.focus();if(!this.cmp.execCmd("InsertHTML",h)){this.cmp.pasteHtmlToRange(c.range,h);}var j=this.cmp.getEditorBody();var g=j.getElementsByTagName("a");for(var f=0;f<g.length;f++){var o=g[f].id;if(o==e){g[f].target=k;g[f].href=d;g[f].id=null;}}this.cmp.syncValue();this.cmp.deferFocus();}}else{this.cmp.insertAtCursor(h);}this.linkWindow.hide();}else{if(!m.findField("url").isValid()){m.findField("url").getEl().frame();}else{if(!m.findField("target").isValid()){m.findField("target").getEl().frame();}}}},scope:this},{text:this.langCancel,handler:function(){this.linkWindow.hide();},scope:this}],listeners:{show:{fn:function(){var d=this.linkWindow.getComponent("insert-link").getForm();var e=d.findField("text");e.setValue(c.textContent);e.setDisabled(c.hasHTML);var f=d.findField("url");f.reset();f.focus(true,50);},scope:this,defer:350},hide:{fn:function(){this.linkWindow=null;},scope:this}}});this.linkWindow.show();}else{this.linkWindow.show();this.linkWindow.getEl().frame();}},scope:this,tooltip:this.langTitle,overflowText:this.langTitle});}});Ext.ux.form.HtmlEditor.Unlink=Ext.extend(Ext.ux.form.HtmlEditor.MidasCommand,{midasBtns:[{enableOnSelection:true,cmd:"unlink",tooltip:{title:"Remove Link"},overflowText:"Remove Link"}]});Ext.ux.form.HtmlEditor.RemoveFormat=Ext.extend(Ext.ux.form.HtmlEditor.MidasCommand,{midasBtns:["|",{enableOnSelection:true,cmd:"removeFormat",tooltip:{title:"Remove Formatting"},overflowText:"Remove Formatting"}]});Ext.ux.form.HtmlEditor.SpecialCharacters=Ext.extend(Ext.util.Observable,{langTitle:"Insert Special Character",langInsert:"Insert",langCancel:"Cancel",specialChars:[153],charRange:[160,256],chars:[],init:function(a){this.cmp=a;this.cmp.on("render",this.onRender,this);},onRender:function(){var b=this.cmp;var a=this.cmp.getToolbar().addButton({iconCls:"x-edit-char",handler:function(){if(!this.chars.length){if(this.specialChars.length){Ext.each(this.specialChars,function(e,d){this.chars[d]=["&#"+e+";"];},this);}for(i=this.charRange[0];i<this.charRange[1];i++){this.chars.push(["&#"+i+";"]);}}var c=new Ext.data.ArrayStore({fields:["char"],data:this.chars});this.charWindow=new Ext.Window({title:this.langTitle,width:436,autoHeight:true,layout:"fit",items:[{xtype:"dataview",store:c,ref:"charView",autoHeight:true,multiSelect:true,tpl:new Ext.XTemplate('<tpl for="."><div class="char-item">{char}</div></tpl><div class="x-clear"></div>'),overClass:"char-over",itemSelector:"div.char-item",listeners:{dblclick:function(f,d,h,g){this.insertChar(f.getStore().getAt(d).get("char"));this.charWindow.close();},scope:this}}],buttons:[{text:this.langInsert,handler:function(){Ext.each(this.charWindow.charView.getSelectedRecords(),function(d){var e=d.get("char");this.insertChar(e);},this);this.charWindow.close();},scope:this},{text:this.langCancel,handler:function(){this.charWindow.close();},scope:this}]});this.charWindow.show();},scope:this,tooltip:{title:this.langTitle},overflowText:this.langTitle});},insertChar:function(a){if(a){this.cmp.insertAtCursor(a);}}});Ext.ux.form.HtmlEditor.SubSuperScript=Ext.extend(Ext.ux.form.HtmlEditor.MidasCommand,{midasBtns:["|",{enableOnSelection:true,cmd:"subscript",tooltip:{title:"Subscript"},overflowText:"Subscript"},{enableOnSelection:true,cmd:"superscript",tooltip:{title:"Superscript"},overflowText:"Superscript"}]});Ext.ux.form.HtmlEditor.Table=Ext.extend(Ext.util.Observable,{langTitle:"Insert Table",langInsert:"Insert",langCancel:"Cancel",langRows:"Rows",langColumns:"Columns",langBorder:"Border",langCellLabel:"Label Cells",cmd:"table",showCellLocationText:true,cellLocationText:"{0}&nbsp;-&nbsp;{1}",tableBorderOptions:[["none","None"],["1px solid #000","Sold Thin"],["2px solid #000","Solid Thick"],["1px dashed #000","Dashed"],["1px dotted #000","Dotted"]],init:function(a){this.cmp=a;this.cmp.on("render",this.onRender,this);},onRender:function(){var a=this.cmp.getToolbar().addButton({iconCls:"x-edit-table",handler:function(){if(!this.tableWindow){this.tableWindow=new Ext.Window({title:this.langTitle,closeAction:"hide",width:235,items:[{itemId:"insert-table",xtype:"form",border:false,plain:true,bodyStyle:"padding: 10px;",labelWidth:65,labelAlign:"right",items:[{xtype:"numberfield",allowBlank:false,allowDecimals:false,fieldLabel:this.langRows,name:"row",width:60},{xtype:"numberfield",allowBlank:false,allowDecimals:false,fieldLabel:this.langColumns,name:"col",width:60},{xtype:"combo",fieldLabel:this.langBorder,name:"border",forceSelection:true,mode:"local",store:new Ext.data.ArrayStore({autoDestroy:true,fields:["spec","val"],data:this.tableBorderOptions}),triggerAction:"all",value:"none",displayField:"val",valueField:"spec",anchor:"-15"},{xtype:"checkbox",fieldLabel:this.langCellLabel,checked:this.showCellLocationText,listeners:{check:function(){this.showCellLocationText=!this.showCellLocationText;},scope:this}}]}],buttons:[{text:this.langInsert,handler:function(){var g=this.tableWindow.getComponent("insert-table").getForm();if(g.isValid()){var d=g.findField("border").getValue();var b=[g.findField("row").getValue(),g.findField("col").getValue()];if(b.length==2&&b[0]>0&&b[1]>0){var j=Math.floor(100/b[0]);var f="<table style='border-collapse: collapse'>";var e="&nbsp;";if(this.showCellLocationText){e=this.cellLocationText;}for(var h=0;h<b[0];h++){f+="<tr>";for(var c=0;c<b[1];c++){f+="<td width='"+j+"%' style='border: "+d+";'>"+String.format(e,(h+1),String.fromCharCode(c+65))+"</td>";}f+="</tr>";}f+="</table>";this.cmp.insertAtCursor(f);}this.tableWindow.hide();}else{if(!g.findField("row").isValid()){g.findField("row").getEl().frame();}else{if(!g.findField("col").isValid()){g.findField("col").getEl().frame();}}}},scope:this},{text:this.langCancel,handler:function(){this.tableWindow.hide();},scope:this}]});}else{this.tableWindow.getEl().frame();}this.tableWindow.show();},scope:this,tooltip:{title:this.langTitle},overflowText:this.langTitle});}});Ext.ux.form.HtmlEditor.UndoRedo=Ext.extend(Ext.ux.form.HtmlEditor.MidasCommand,{midasBtns:["|",{cmd:"undo",tooltip:{title:"Undo"},overflowText:"Undo"},{cmd:"redo",tooltip:{title:"Redo"},overflowText:"Redo"}]});Ext.ux.form.HtmlEditor.Word=Ext.extend(Ext.util.Observable,{langTitle:"Word Paste",langToolTip:"Cleanse text pasted from Word or other Rich Text applications",wordPasteEnabled:true,curLength:0,lastLength:0,lastValue:"",init:function(a){this.cmp=a;this.cmp.on("render",this.onRender,this);this.cmp.on("initialize",this.onInit,this,{delay:100,single:true});},onInit:function(){Ext.EventManager.on(this.cmp.getDoc(),{keyup:this.checkIfPaste,scope:this});this.lastValue=this.cmp.getValue();this.curLength=this.lastValue.length;this.lastLength=this.lastValue.length;},checkIfPaste:function(c){var a=0;this.curLength=this.cmp.getValue().length;if(c.V==c.getKey()&&c.ctrlKey&&this.wordPasteEnabled){this.cmp.suspendEvents();a=this.findValueDiffAt(this.cmp.getValue());var b=[this.cmp.getValue().substr(0,a),this.fixWordPaste(this.cmp.getValue().substr(a,(this.curLength-this.lastLength))),this.cmp.getValue().substr((this.curLength-this.lastLength)+a,this.curLength)];this.cmp.setValue(b.join(""));this.cmp.resumeEvents();}this.lastLength=this.cmp.getValue().length;this.lastValue=this.cmp.getValue();},findValueDiffAt:function(a){for(i=0;i<this.curLength;i++){if(this.lastValue[i]!=a[i]){return i;}}},fixWordPaste:function(a){var b=[/&nbsp;/ig,/[\r\n]/g,/<(xml|style)[^>]*>.*?<\/\1>/ig,/<\/?(meta|object|span)[^>]*>/ig,/<\/?[A-Z0-9]*:[A-Z]*[^>]*>/ig,/(lang|class|type|href|name|title|id|clear)=\"[^\"]*\"/ig,/style=(\'\'|\"\")/ig,/<![\[-].*?-*>/g,/MsoNormal/g,/<\\?\?xml[^>]*>/g,/<\/?o:p[^>]*>/g,/<\/?v:[^>]*>/g,/<\/?o:[^>]*>/g,/<\/?st1:[^>]*>/g,/&nbsp;/g,/<\/?SPAN[^>]*>/g,/<\/?FONT[^>]*>/g,/<\/?STRONG[^>]*>/g,/<\/?H1[^>]*>/g,/<\/?H2[^>]*>/g,/<\/?H3[^>]*>/g,/<\/?H4[^>]*>/g,/<\/?H5[^>]*>/g,/<\/?H6[^>]*>/g,/<\/?P[^>]*><\/P>/g,/<!--(.*)-->/g,/<!--(.*)>/g,/<!(.*)-->/g,/<\\?\?xml[^>]*>/g,/<\/?o:p[^>]*>/g,/<\/?v:[^>]*>/g,/<\/?o:[^>]*>/g,/<\/?st1:[^>]*>/g,/style=\"[^\"]*\"/g,/style=\'[^\"]*\'/g,/lang=\"[^\"]*\"/g,/lang=\'[^\"]*\'/g,/class=\"[^\"]*\"/g,/class=\'[^\"]*\'/g,/type=\"[^\"]*\"/g,/type=\'[^\"]*\'/g,/href=\'#[^\"]*\'/g,/href=\"#[^\"]*\"/g,/name=\"[^\"]*\"/g,/name=\'[^\"]*\'/g,/ clear=\"all\"/g,/id=\"[^\"]*\"/g,/title=\"[^\"]*\"/g,/<span[^>]*>/g,/<\/?span[^>]*>/g,/<title>(.*)<\/title>/g,/class=/g,/<meta[^>]*>/g,/<link[^>]*>/g,/<style>(.*)<\/style>/g,/<w:[^>]*>(.*)<\/w:[^>]*>/g];Ext.each(b,function(c){a=a.replace(c,"");});a=a.replace(/<div[^>]*>/g,"<p>");a=a.replace(/<\/?div[^>]*>/g,"</p>");return a;},onRender:function(){this.cmp.getToolbar().add({iconCls:"x-edit-wordpaste",pressed:true,handler:function(a){if(a.toggle){a.toggle(!a.pressed);}else{a.pressed=!a.pressed;}this.wordPasteEnabled=!this.wordPasteEnabled;},scope:this,tooltip:{text:this.langToolTip},overflowText:this.langTitle});}});Ext.ux.form.HtmlEditor.plugins=function(){return[new Ext.ux.form.HtmlEditor.Link(),new Ext.ux.form.HtmlEditor.IndentOutdent()];};var JavaScriptEscaper={regex:{escapeUnclosed:RegExp("<\\s*(script.*?)>([\\s\\S]*)","g"),escape:RegExp("<\\s*(script.*?)>([\\s\\S]*?)<\\s*(/+\\s*script.*?)>","g"),unescapeUnclosed:RegExp("<!--\\s*(script.*?)--><!--([\\s\\S]*?)--><!--()-->","g"),unescape:RegExp("<!--\\s*(script.*?)--><!--([\\s\\S]*?)--><!--\\s*(/+script.*?)-->","g")},escapeScripts:function(c){var b;var a=c;while((b=this.regex.escape.exec(a))){c=this._escapeMatch(c,b,true);}while((b=this.regex.escapeUnclosed.exec(a))){c=this._escapeMatch(c,b,false);}return c;},unescapeScripts:function(c){var b;var a=c;while((b=this.regex.unescape.exec(a))){c=this._unescapeMatch(c,b);}while((b=this.regex.unescapeUnclosed.exec(a))){c=this._unescapeMatch(c,b);}return c;},_escapeMatch:function(e,c,d){var b="<!--"+c[1]+"-->";var f="<!--"+(d?c[3]:"")+"-->";var a="<!--"+encodeURIComponent(c[2])+"-->";return e.replace(c[0],b+a+f);},_unescapeMatch:function(d,c){var b="<"+c[1]+">";var a=decodeURIComponent(c[2]);var e=(c[3]!=""?"<"+c[3]+">":"");return d.replace(c[0],b+a+e);}};Ext.form.WholeHtmlEditor=Ext.extend(Ext.form.HtmlEditor,{tagsToComment:["!DOCTYPE","html","head","body","nlform","form"],pushValue:function(){var f=this,b;if(f.initialized){b=f.el.dom.value||"";if(!f.activated&&b.length<1){b=f.defaultValue;}if(f.fireEvent("beforepush",f,b)!==false){var a=b;for(var e=0;e<f.tagsToComment.length;e++){b=b.replace(RegExp("<(\\s*/?"+f.tagsToComment[e]+".*?)>","ig"),"<!--$1-->");}b=JavaScriptEscaper.escapeScripts(b);var c=(b!==a);var h=false;if(c){var d=jQuery(b);var g=jQuery(f.getEditorBody());g.html("").append(d);h=(b!=""&&f.getEditorBody().innerHTML=="");}if(!c||h){f.getEditorBody().innerHTML=b;}if(Ext.isGecko){f.setDesignMode(false);f.setDesignMode(true);}f.fireEvent("push",f,b);}}},cleanHtml:function(c){var d=this,b,a=this.cleanHtmlWithStrictMSO(c,false);for(b=0;b<d.tagsToComment.length;b++){a.html=a.html.replace(RegExp("<!--(\\s*/?"+d.tagsToComment[b]+".*?)-->","ig"),"<$1>");}a.html=JavaScriptEscaper.unescapeScripts(a.html);return a;}});(function(){var l=/^<(\w+)((?:\s+\w+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,d=/^<\/(\w+)[^>]*>/,g=/(\w+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g;var f=c("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed");var b=c("address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul");var j=c("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var");var e=c("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr");var k=c("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected");var h=c("script,style");var a=this.NLJSHTMLParser=function(n,v){var q,r,o,s=[],t=n;s.last=function(){return this[this.length-1];};while(n){r=true;if(!s.last()||!h[s.last()]){if(n.indexOf("<!--")==0){q=n.indexOf("-->");if(q>=0){if(v.comment){v.comment(n.substring(4,q));}n=n.substring(q+3);r=false;}}else{if(n.indexOf("</")==0){o=n.match(d);if(o){n=n.substring(o[0].length);o[0].replace(d,p);r=false;}}else{if(n.indexOf("<")==0){o=n.match(l);if(o){n=n.substring(o[0].length);o[0].replace(l,m);r=false;}}}}if(r){q=n.indexOf("<");var u=q<0?n:n.substring(0,q);n=q<0?"":n.substring(q);if(v.chars){v.chars(u);}}}else{n=n.replace(new RegExp("(.*)</"+s.last()+"[^>]*>"),function(w,x){x=x.replace(/<!--(.*?)-->/g,"$1").replace(/<!\[CDATA\[(.*?)]]>/g,"$1");if(v.chars){v.chars(x);}return"";});p("",s.last());}if(n==t){throw"Parse Error: "+n;}t=n;}p();function m(w,z,A,x){if(b[z]){while(s.last()&&j[s.last()]){p("",s.last());}}if(e[z]&&s.last()==z){p("",z);}x=f[z]||!!x;if(!x){s.push(z);}if(v.start){var y=[];A.replace(g,function(C,B){var D=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:k[B]?B:"";y.push({name:B,value:D,escaped:D.replace(/(^|[^\\])"/g,'$1\\"')});});if(v.start){v.start(z,y,x);}}}function p(w,y){if(!y){var z=0;}else{for(var z=s.length-1;z>=0;z--){if(s[z]==y){break;}}}if(z>=0){for(var x=s.length-1;x>=z;x--){if(v.end){v.end(s[x]);}}s.length=z;}}};this.HTMLtoXML=function(n){var m="";a(n,{start:function(o,q,p){m+="<"+o;for(var r=0;r<q.length;r++){m+=" "+q[r].name+'="'+q[r].escaped+'"';}m+=(p?"/":"")+">";},end:function(o){m+="</"+o+">";},chars:function(o){m+=o;},comment:function(o){m+="<!--"+o+"-->";}});return m;};this.HTMLtoDOM=function(q,t){var p=c("html,head,body,title");var m={link:"head",base:"head"};if(!t){if(typeof DOMDocument!="undefined"){t=new DOMDocument();}else{if(typeof document!="undefined"&&document.implementation&&document.implementation.createDocument){t=document.implementation.createDocument("","",null);}else{if(typeof ActiveX!="undefined"){t=new ActiveXObject("Msxml.DOMDocument");}}}}else{t=t.ownerDocument||t.getOwnerDocument&&t.getOwnerDocument()||t;}var n=[],s=t.documentElement||t.getDocumentElement&&t.getDocumentElement();if(!s&&t.createElement){(function(){var v=t.createElement("html");var u=t.createElement("head");u.appendChild(t.createElement("title"));v.appendChild(u);v.appendChild(t.createElement("body"));t.appendChild(v);})();}if(t.getElementsByTagName){for(var o in p){p[o]=t.getElementsByTagName(o)[0];}}var r=p.body;a(q,{start:function(x,w,v){if(p[x]){r=p[x];return;}var y=t.createElement(x);for(var u in w){y.setAttribute(w[u].name,w[u].value);}if(m[x]&&typeof p[m[x]]!="boolean"){p[m[x]].appendChild(y);}else{if(r&&r.appendChild){r.appendChild(y);}}if(!v){n.push(y);r=y;}},end:function(u){n.length-=1;r=n[n.length-1];},chars:function(u){r.appendChild(t.createTextNode(u));},comment:function(u){}});return t;};function c(p){var o={},m=p.split(",");for(var n=0;n<m.length;n++){o[m[n]]=true;}return o;}})();Ext.ns("NetSuite");NetSuite.JSDiff=function(){return{escape:function(a){var b=a;b=b.replace(/&/g,"&amp;");b=b.replace(/</g,"&lt;");b=b.replace(/>/g,"&gt;");b=b.replace(/"/g,"&quot;");return b;},diffString:function(g,h){g=g.replace(/\s+$/,"");h=h.replace(/\s+$/,"");var b=this.diff(g==""?[]:g.split(/\s+/),h==""?[]:h.split(/\s+/));var f="";var a=g.match(/\s+/g);if(a==null){a=["\n"];}else{a.push("\n");}var d=h.match(/\s+/g);if(d==null){d=["\n"];}else{d.push("\n");}if(b.n.length==0){for(var c=0;c<b.o.length;c++){f+="<del>"+this.escape(b.o[c])+a[c]+"</del>";}}else{if(b.n[0].text==null){for(h=0;h<b.o.length&&b.o[h].text==null;h++){f+="<del>"+this.escape(b.o[h])+a[h]+"</del>";}}for(var c=0;c<b.n.length;c++){if(b.n[c].text==null){f+="<ins>"+this.escape(b.n[c])+d[c]+"</ins>";}else{var e="";for(h=b.n[c].row+1;h<b.o.length&&b.o[h].text==null;h++){e+="<del>"+this.escape(b.o[h])+a[h]+"</del>";}f+=" "+b.n[c].text+d[c]+e;}}}return f;},randomColor:function(){return"rgb("+(Math.random()*100)+"%, "+(Math.random()*100)+"%, "+(Math.random()*100)+"%)";},diffString2:function(b,c){b=b.replace(/\s+$/,"");c=c.replace(/\s+$/,"");var e=this.diff(b==""?[]:b.split(/\s+/),c==""?[]:c.split(/\s+/));var j=b.match(/\s+/g);if(j==null){j=["\n"];}else{j.push("\n");}var g=c.match(/\s+/g);if(g==null){g=["\n"];}else{g.push("\n");}var d="";var a=new Array();for(var f=0;f<e.o.length;f++){a[f]=this.randomColor();if(e.o[f].text!=null){d+='<span style="background-color: '+a[f]+'">'+this.escape(e.o[f].text)+j[f]+"</span>";}else{d+="<del>"+this.escape(e.o[f])+j[f]+"</del>";}}var h="";for(var f=0;f<e.n.length;f++){if(e.n[f].text!=null){h+='<span style="background-color: '+a[e.n[f].row]+'">'+this.escape(e.n[f].text)+g[f]+"</span>";}else{h+="<ins>"+this.escape(e.n[f])+g[f]+"</ins>";}}return{o:d,n:h};},diff:function(d,e){var b=new Object();var c=new Object();for(var a=0;a<e.length;a++){if(b[e[a]]==null){b[e[a]]={rows:new Array(),o:null};}b[e[a]].rows.push(a);}for(var a=0;a<d.length;a++){if(c[d[a]]==null){c[d[a]]={rows:new Array(),n:null};}c[d[a]].rows.push(a);}for(var a in b){if(b[a].rows.length==1&&typeof(c[a])!="undefined"&&c[a].rows.length==1){e[b[a].rows[0]]={text:e[b[a].rows[0]],row:c[a].rows[0]};d[c[a].rows[0]]={text:d[c[a].rows[0]],row:b[a].rows[0]};}}for(var a=0;a<e.length-1;a++){if(e[a].text!=null&&e[a+1].text==null&&e[a].row+1<d.length&&d[e[a].row+1].text==null&&e[a+1]==d[e[a].row+1]){e[a+1]={text:e[a+1],row:e[a].row+1};d[e[a].row+1]={text:d[e[a].row+1],row:a+1};}}for(var a=e.length-1;a>0;a--){if(e[a].text!=null&&e[a-1].text==null&&e[a].row>0&&d[e[a].row-1].text==null&&e[a-1]==d[e[a].row-1]){e[a-1]={text:e[a-1],row:e[a].row-1};d[e[a].row-1]={text:d[e[a].row-1],row:a-1};}}return{o:d,n:e};}};}();function UUID(){this.id=this.createUUID();}UUID.prototype.valueOf=function(){return this.id;};UUID.prototype.toString=function(){return this.id;};UUID.prototype.createUUID=function(){var d=new Date(1582,10,15,0,0,0,0);var g=new Date();var k=g.getTime()-d.getTime();var b="-";var l=UUID.getIntegerBits(k,0,31);var j=UUID.getIntegerBits(k,32,47);var f=UUID.getIntegerBits(k,48,59)+"1";var c=UUID.getIntegerBits(UUID.rand(4095),0,7);var e=UUID.getIntegerBits(UUID.rand(4095),0,7);var a=UUID.getIntegerBits(UUID.rand(8191),0,7)+UUID.getIntegerBits(UUID.rand(8191),8,15)+UUID.getIntegerBits(UUID.rand(8191),0,7)+UUID.getIntegerBits(UUID.rand(8191),8,15)+UUID.getIntegerBits(UUID.rand(8191),0,15);return l+b+j+b+f+b+c+e+b+a;};UUID.getIntegerBits=function(f,g,b){var a=UUID.returnBase(f,16);var d=new Array();var e="";var c=0;for(c=0;c<a.length;c++){d.push(a.substring(c,c+1));}for(c=Math.floor(g/4);c<=Math.floor(b/4);c++){if(!d[c]||d[c]==""){e+="0";}else{e+=d[c];}}return e;};UUID.returnBase=function(a,b){return(a).toString(b).toUpperCase();};UUID.rand=function(a){return Math.floor(Math.random()*(a+1));};